# 功能开发原则

## 核心原则
在开发前后端功能时，优先评估是否基于已有功能进行迭代、提取、抽象，避免项目功能割裂。

## 开发决策流程

### 1. 功能需求分析阶段
在开始开发任何新功能前，必须进行以下评估：

#### 现有功能评估
- **功能相似性分析**：新需求与现有功能的相似度
- **代码复用可能性**：是否可以复用现有组件、服务、接口
- **架构一致性**：新功能是否符合现有架构模式

#### 开发方案对比
必须对比以下两种方案：
1. **基于现有功能迭代**：扩展、改造、抽象现有功能
2. **添加全新功能**：创建新的页面、接口、组件

### 2. 决策咨询机制
在确定开发方案前，必须：
- **向用户说明**：详细描述两种方案的优缺点
- **征求用户意见**：让用户参与决策过程
- **确认最终方案**：获得用户明确确认后再开始开发

## 优先选择迭代的场景

### 前端开发
- **页面功能扩展**：在现有页面添加新功能模块
- **组件能力增强**：扩展现有组件的功能和配置项
- **交互流程优化**：改进现有用户操作流程
- **数据展示增强**：在现有图表、表格基础上添加新的展示维度

### 后端开发
- **接口功能扩展**：在现有接口添加新的参数和返回字段
- **服务能力增强**：扩展现有服务类的功能
- **数据模型演进**：在现有实体基础上添加新字段或关联
- **业务逻辑优化**：改进现有业务处理流程

## 避免的割裂模式

### 禁止的开发模式
- **功能孤岛**：每个新需求都创建独立的页面和接口
- **重复造轮子**：忽视现有功能，重新实现相似逻辑
- **接口冗余**：为相似功能创建多个接口
- **组件碎片化**：创建功能重叠的多个组件

### 常见割裂场景示例
```
❌ 错误做法：
- 股票搜索页面 + 期货搜索页面（两个独立页面）
- /api/stock/search + /api/futures/search（两个独立接口）
- StockCard + FuturesCard（两个相似组件）

✅ 正确做法：
- 统一搜索页面，支持股票/期货切换
- /api/search?type=stock|futures（统一接口）
- UniversalCard 组件，支持不同数据类型
```

## 实施策略

### 1. 抽象层次设计
- **通用组件**：设计可配置的通用组件
- **统一接口**：设计支持多种数据类型的接口
- **策略模式**：使用策略模式处理不同业务逻辑
- **配置驱动**：通过配置控制功能行为

### 2. 渐进式重构
- **功能合并**：将相似功能逐步合并
- **接口统一**：将多个相似接口合并为通用接口
- **组件抽象**：将重复组件抽象为通用组件
- **代码复用**：提取公共逻辑到工具类或服务

### 3. 架构一致性
- **命名规范**：保持一致的命名风格
- **目录结构**：遵循统一的目录组织方式
- **设计模式**：使用一致的设计模式
- **技术栈**：避免引入不必要的新技术

## 决策模板

### 功能开发决策模板
```
## 功能需求
[描述新功能需求]

## 现有功能分析
[分析相关的现有功能]

## 方案对比

### 方案一：基于现有功能迭代
**优点：**
- [列出优点]

**缺点：**
- [列出缺点]

**工作量：**
- [评估工作量]

### 方案二：添加全新功能
**优点：**
- [列出优点]

**缺点：**
- [列出缺点]

**工作量：**
- [评估工作量]

## 推荐方案
[说明推荐的方案及理由]

## 用户确认
请确认选择哪种方案进行开发。
```

## 成功案例

### 示例：统一搜索功能
**需求**：添加期货搜索功能

**现有功能**：股票搜索页面和接口

**迭代方案**：
- 扩展搜索页面，添加股票/期货切换
- 扩展搜索接口，支持 type 参数
- 抽象 SearchCard 组件，支持不同数据类型

**效果**：
- 用户体验一致
- 代码复用率高
- 维护成本低

### 示例：通用回测功能
**需求**：添加期货回测功能

**现有功能**：股票回测系统

**迭代方案**：
- 抽象 UniversalBacktestEngine
- 设计通用数据适配器
- 扩展回测配置组件

**效果**：
- 回测逻辑统一
- 策略可复用
- 扩展性强

## 评估指标

### 成功指标
- **代码复用率**：新功能中复用代码的比例
- **接口一致性**：接口设计的一致性程度
- **用户体验**：功能间操作的一致性
- **维护成本**：后续维护和扩展的难易程度

### 避免指标
- **页面数量增长**：避免功能相似的页面过多
- **接口冗余度**：避免功能重叠的接口
- **组件碎片化**：避免功能相似的组件过多
- **代码重复率**：避免相似逻辑的重复实现

## 适用范围
- 所有新功能开发
- 功能扩展和优化
- 架构重构和优化
- 代码复用和抽象

## 注意事项
- 不要为了复用而过度抽象
- 保持功能的独立性和可测试性
- 考虑性能和可维护性的平衡
- 及时重构和优化现有代码